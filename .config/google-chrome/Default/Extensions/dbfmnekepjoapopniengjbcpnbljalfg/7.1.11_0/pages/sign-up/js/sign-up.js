"use strict";var infinityApi="https://api.infinitynewtab.com",register=new Vue({el:"#register",template:"#J-register-template",data:{screenSize:!0,email:"",emailIsTrue:!1,clearEmail:!1,pwd:"",pwdIsTrue:!1,yzm:"",verify:"",yzmIsTrue:!1,clearPwd:!1,clearYzm:!1},created:function(){this.sendAjax("get","/verify.php",{},function(e){$("#verify").attr("src",e.img),this.verify=e.code}.bind(this))},mounted:function(){var e=document.getElementsByTagName("body")[0].offsetHeight;this.screenSize=!(e<540),window.onresize=function(e){var i=document.getElementsByTagName("body")[0].offsetHeight;this.screenSize=!(i<540)}.bind(this)},watch:{yzm:function(e,i){if(this.clearYzm=0<e.length,4<e.length){e=e.substring(0,4);this.yzm=e}md5(e)==this.verify?(this.yzmIsTrue=!0,$(".reginst-yzm-img").next().removeClass("register-input-is-false").addClass("register-input-is-true")):(this.yzmIsTrue=!1,$(".reginst-yzm-img").next().removeClass("register-input-is-true").addClass("register-input-is-false"))},email:function(e,i){this.clearEmail=0<e.length},pwd:function(e,i){this.clearPwd=0<e.length}},methods:{registerEmailReg:function(){/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/i.test(this.email)?(this.sendAjax("get","/checkName.php?name="+this.email,{},function(e){if("error"==e)return this.emailIsTrue=!1,void $(".register-input-email").html(infinity.i18n("net_error")).prev().removeClass("register-input-is-true").addClass("register-input-is-false");"Success"==e.desc&&"1"==e.message?(this.emailIsTrue=!0,$(".register-input-email").html("").prev().removeClass("register-input-is-false").addClass("register-input-is-true")):(this.emailIsTrue=!1,$(".register-input-email").html(infinity.i18n("account_already_exists")).prev().removeClass("register-input-is-true").addClass("register-input-is-false"))}.bind(this)),this.emailIsTrue=!1,$(".register-input-email").html("").prev().removeClass("register-input-is-false").addClass("register-input-is-true")):(this.emailIsTrue=!0,$(".register-input-email").html(infinity.i18n("format_error")).prev().removeClass("register-input-is-true").addClass("register-input-is-false"))},registerPwdReg:function(){/^[A-Za-z0-9_]{6,20}$/.test(this.pwd)?(this.pwdIsTrue=!0,$(".register-input-pwd").html("").prev().removeClass("register-input-is-false").addClass("register-input-is-true")):(this.pwdIsTrue=!1,$(".register-input-pwd").html(infinity.i18n("password_min")).prev().removeClass("register-input-is-true").addClass("register-input-is-false"))},registerYzmReg:function(){md5(this.yzm)==this.verify?this.yzmIsTrue=!0:this.yzmIsTrue=!1},changeVerify:function(){this.sendAjax("get","/verify.php",{},function(e){this.yzmIsTrue=!1,$("#verify").attr("src",e.img),this.verify=e.code}.bind(this))},clearContent:function(e){this[e]="","email"==e?$(".register-input-"+e).html(infinity.i18n("must_fill")).prev().removeClass("register-input-is-true").addClass("register-input-is-false"):"pwd"==e&&$(".register-input-"+e).html(infinity.i18n("must_fill")).prev().removeClass("register-input-is-true").addClass("register-input-is-false")},goSubmit:function(){if(this.emailIsTrue)if(this.pwdIsTrue){if(this.yzmIsTrue){var e={name:this.email,password:md5(this.pwd),code:this.yzm,version:2};this.sendAjax("get","/register.php",e,function(e){if("error"==e)return this.changeVerify(),void(this.yzm="");if(1==e.message){var i=infinity.get("infinity-user");i.email=this.email,i.password=md5(this.pwd);try{i.name=this.email.split("@")[0]}catch(e){i.name="Spock Undefined"}i.isLogin=!0,i.backupTime=0,infinity.set("infinity-user",i),infinity.sendMessage("userStatusChange"),infinity.sendMessage("signUpSuccess"),window.close()}else this.changeVerify(),this.yzm=""}.bind(this))}}else $(".register-input-pwd").html(infinity.i18n("password_min"));else $(".register-input-email").html(infinity.i18n("please_enter_format_email"))},sendAjax:function(e,i,s,t){$.ajax({type:e,url:infinityApi+i,dataType:"json",data:s,success:function(e){t&&t(e)},error:function(){t&&t("error")}})}}});